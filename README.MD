# Инструкция по запуску Telegram бота с использованием Docker Compose

Это руководство поможет вам запустить Telegram бота с использованием Docker Compose. В проекте используется несколько сервисов: основное приложение (бот), база данных PostgreSQL и Redis.

## Предварительные требования

1. Убедитесь, что у вас установлены Docker и Docker Compose. Если они не установлены, следуйте официальной документации:
   - [Установка Docker](https://docs.docker.com/get-docker/)
   - [Установка Docker Compose](https://docs.docker.com/compose/install/)

2. Склонируйте репозиторий с проектом на ваш локальный компьютер.

## Настройка .env файла

Перед запуском приложения необходимо создать и заполнить файл `.env` в корневой директории проекта. Этот файл содержит переменные окружения, необходимые для работы бота и сервисов.

Пример содержимого `.env` файла (на основе `.env.example`):

```plaintext
# Telegram Bot Token
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here

# Redis configuration
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=your_redis_password_here
REDIS_DB=0

# PostgreSQL configuration
POSTGRES_HOST=db
POSTGRES_PORT=5432
POSTGRES_DB=your_database_name_here
POSTGRES_USER=your_database_user_here
POSTGRES_PASSWORD=your_database_password_here
```

### Как получить Telegram Bot Token

1. Откройте Telegram и найдите бота [BotFather](https://t.me/BotFather).
2. Начните диалог с BotFather и используйте команду `/newbot` для создания нового бота.
3. Следуйте инструкциям BotFather, чтобы задать имя и username бота.
4. После создания бота, BotFather предоставит вам токен. Скопируйте этот токен и вставьте его в переменную `TELEGRAM_BOT_TOKEN` в файле `.env`.

### Заполнение остальных переменных

- **Redis:**
  - `REDIS_HOST`: Оставьте значение `redis`, так как это имя сервиса в Docker Compose.
  - `REDIS_PORT`: Оставьте значение `6379`, если не используете другой порт.
  - `REDIS_PASSWORD`: Задайте пароль для Redis.
  - `REDIS_DB`: Оставьте значение `0`, если не требуется использовать другую базу данных.

- **PostgreSQL:**
  - `POSTGRES_HOST`: Оставьте значение `db`, так как это имя сервиса в Docker Compose.
  - `POSTGRES_PORT`: Оставьте значение `5432`, если не используете другой порт.
  - `POSTGRES_DB`: Задайте имя базы данных.
  - `POSTGRES_USER`: Задайте имя пользователя базы данных.
  - `POSTGRES_PASSWORD`: Задайте пароль для пользователя базы данных.

## Запуск приложения

1. Откройте терминал и перейдите в корневую директорию проекта.

2. Запустите сборку и запуск контейнеров с помощью команды:

   ```bash
   docker-compose up --build
   ```

   - Флаг `--build` указывает Docker Compose пересобрать образы перед запуском.
   - Если вы хотите запустить контейнеры в фоновом режиме, добавьте флаг `-d`:

     ```bash
     docker-compose up --build -d
     ```

3. После успешного запуска, бот будет готов к работе и начнет отвечать на сообщения в Telegram.

## Остановка приложения

Чтобы остановить и удалить контейнеры, выполните команду:

```bash
docker-compose down
```

Если вы хотите также удалить тома (volumes), добавьте флаг `-v`:

```bash
docker-compose down -v
```

## Дополнительные команды

- **Просмотр логов сервиса:**  
  Чтобы просмотреть логи конкретного сервиса (например, `server`), выполните:

  ```bash
  docker-compose logs -f server
  ```

- **Пересборка и перезапуск сервиса:**  
  Если вы внесли изменения в код и хотите пересобрать и перезапустить только один сервис (например, `server`), выполните:

  ```bash
  docker-compose up --build --force-recreate --no-deps server
  ```

## Структура Docker Compose файла

- **server:** Основное приложение (Telegram бот), которое использует порт `8000` и зависит от сервисов `db` и `redis`.
- **db:** Сервис базы данных PostgreSQL. Данные сохраняются в томе `db_data`.
- **redis:** Сервис Redis. Данные сохраняются в томе `redis_data`.

## Проблемы и устранение неисправностей

- **Проблемы с подключением к базе данных:**  
  Убедитесь, что переменные окружения в `.env` файле корректны и соответствуют настройкам в `docker-compose.yml`.

- **Проблемы с Redis:**  
  Проверьте, что Redis запущен и доступен по указанному URL.

- **Логи:**  
  Используйте команду `docker-compose logs` для просмотра логов и диагностики проблем.